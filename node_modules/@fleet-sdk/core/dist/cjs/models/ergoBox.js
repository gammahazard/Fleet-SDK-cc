"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErgoBox = void 0;
const common_1 = require("@fleet-sdk/common");
const blake2b_1 = require("@noble/hashes/blake2b");
const utils_1 = require("@noble/hashes/utils");
const boxSerializer_1 = require("../serializer/sigma/boxSerializer");
class ErgoBox {
    boxId;
    value;
    ergoTree;
    creationHeight;
    assets;
    additionalRegisters;
    transactionId;
    index;
    constructor(box) {
        this.boxId = box.boxId;
        this.ergoTree = box.ergoTree;
        this.creationHeight = box.creationHeight;
        this.value = (0, common_1.ensureBigInt)(box.value);
        this.assets = box.assets.map((asset) => ({
            tokenId: asset.tokenId,
            amount: (0, common_1.ensureBigInt)(asset.amount)
        }));
        this.additionalRegisters = box.additionalRegisters;
        this.transactionId = box.transactionId;
        this.index = box.index;
    }
    isValid() {
        return ErgoBox.validate(this);
    }
    static validate(box) {
        const bytes = (0, boxSerializer_1.serializeBox)(box);
        const hash = (0, utils_1.bytesToHex)((0, blake2b_1.blake2b)(bytes, { dkLen: 32 }));
        return box.boxId === hash;
    }
}
exports.ErgoBox = ErgoBox;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJnb0JveC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbHMvZXJnb0JveC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSw4Q0FBaUQ7QUFDakQsbURBQWdEO0FBQ2hELCtDQUFpRDtBQUNqRCxxRUFBaUU7QUFFakUsTUFBYSxPQUFPO0lBQ2xCLEtBQUssQ0FBVTtJQUNmLEtBQUssQ0FBVTtJQUNmLFFBQVEsQ0FBVTtJQUNsQixjQUFjLENBQVU7SUFDeEIsTUFBTSxDQUF5QjtJQUMvQixtQkFBbUIsQ0FBeUI7SUFDNUMsYUFBYSxDQUFVO0lBQ3ZCLEtBQUssQ0FBVTtJQUVmLFlBQVksR0FBZ0I7UUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFBLHFCQUFZLEVBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDdkMsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3RCLE1BQU0sRUFBRSxJQUFBLHFCQUFZLEVBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztTQUNuQyxDQUFDLENBQUMsQ0FBQztRQUNKLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxHQUFHLENBQUMsbUJBQW1CLENBQUM7UUFDbkQsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztJQUN6QixDQUFDO0lBRU0sT0FBTztRQUNaLE9BQU8sT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUEwQjtRQUN4QyxNQUFNLEtBQUssR0FBRyxJQUFBLDRCQUFZLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEMsTUFBTSxJQUFJLEdBQUcsSUFBQSxrQkFBVSxFQUFDLElBQUEsaUJBQU8sRUFBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXZELE9BQU8sR0FBRyxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUM7SUFDNUIsQ0FBQztDQUNGO0FBbENELDBCQWtDQyJ9