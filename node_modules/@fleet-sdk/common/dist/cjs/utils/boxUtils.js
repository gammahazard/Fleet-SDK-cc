"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.areRegistersDenselyPacked = exports.utxoSum = void 0;
const bigIntLiterals_1 = require("./bigIntLiterals");
const bigIntUtils_1 = require("./bigIntUtils");
const objectUtils_1 = require("./objectUtils");
const NANOERGS_TOKEN_ID = "nanoErgs";
function utxoSum(boxes, tokenId) {
    const balances = {};
    for (const box of boxes) {
        if ((0, objectUtils_1.isUndefined)(tokenId) || tokenId === NANOERGS_TOKEN_ID) {
            balances[NANOERGS_TOKEN_ID] = (balances[NANOERGS_TOKEN_ID] || bigIntLiterals_1._0n) + (0, bigIntUtils_1.ensureBigInt)(box.value);
        }
        if (tokenId !== NANOERGS_TOKEN_ID) {
            for (const token of box.assets) {
                if ((0, objectUtils_1.isDefined)(tokenId) && tokenId !== token.tokenId) {
                    continue;
                }
                balances[token.tokenId] = (balances[token.tokenId] || bigIntLiterals_1._0n) + (0, bigIntUtils_1.ensureBigInt)(token.amount);
            }
        }
    }
    if ((0, objectUtils_1.isDefined)(tokenId)) {
        return balances[tokenId] || bigIntLiterals_1._0n;
    }
    return {
        nanoErgs: balances[NANOERGS_TOKEN_ID],
        tokens: Object.keys(balances)
            .filter((x) => x !== NANOERGS_TOKEN_ID)
            .map((tokenId) => ({ tokenId, amount: balances[tokenId] }))
    };
}
exports.utxoSum = utxoSum;
const MIN_REGISTER_NUMBER = 4;
const MAX_REGISTER_NUMBER = 9;
function areRegistersDenselyPacked(registers) {
    let lastValueIndex = 0;
    for (let i = MIN_REGISTER_NUMBER; i <= MAX_REGISTER_NUMBER; i++) {
        if (registers[`R${i}`]) {
            if (i === MIN_REGISTER_NUMBER) {
                lastValueIndex = i;
                continue;
            }
            if (i - lastValueIndex > 1) {
                return false;
            }
            lastValueIndex = i;
        }
    }
    return true;
}
exports.areRegistersDenselyPacked = areRegistersDenselyPacked;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm94VXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvYm94VXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EscURBQXVDO0FBQ3ZDLCtDQUE2QztBQUM3QywrQ0FBdUQ7QUFFdkQsTUFBTSxpQkFBaUIsR0FBRyxVQUFVLENBQUM7QUFJckMsU0FBZ0IsT0FBTyxDQUFDLEtBQStCLEVBQUUsT0FBaUI7SUFDeEUsTUFBTSxRQUFRLEdBQWtDLEVBQUUsQ0FBQztJQUVuRCxLQUFLLE1BQU0sR0FBRyxJQUFJLEtBQUssRUFBRTtRQUN2QixJQUFJLElBQUEseUJBQVcsRUFBQyxPQUFPLENBQUMsSUFBSSxPQUFPLEtBQUssaUJBQWlCLEVBQUU7WUFDekQsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxvQkFBRyxDQUFDLEdBQUcsSUFBQSwwQkFBWSxFQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5RjtRQUVELElBQUksT0FBTyxLQUFLLGlCQUFpQixFQUFFO1lBQ2pDLEtBQUssTUFBTSxLQUFLLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRTtnQkFDOUIsSUFBSSxJQUFBLHVCQUFTLEVBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxLQUFLLEtBQUssQ0FBQyxPQUFPLEVBQUU7b0JBQ25ELFNBQVM7aUJBQ1Y7Z0JBRUQsUUFBUSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksb0JBQUcsQ0FBQyxHQUFHLElBQUEsMEJBQVksRUFBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDekY7U0FDRjtLQUNGO0lBRUQsSUFBSSxJQUFBLHVCQUFTLEVBQUMsT0FBTyxDQUFDLEVBQUU7UUFDdEIsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksb0JBQUcsQ0FBQztLQUNqQztJQUVELE9BQU87UUFDTCxRQUFRLEVBQUUsUUFBUSxDQUFDLGlCQUFpQixDQUFDO1FBQ3JDLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQzthQUMxQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxpQkFBaUIsQ0FBQzthQUN0QyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDOUQsQ0FBQztBQUNKLENBQUM7QUE3QkQsMEJBNkJDO0FBRUQsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7QUFDOUIsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7QUFFOUIsU0FBZ0IseUJBQXlCLENBQUMsU0FBZ0M7SUFDeEUsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZCLEtBQUssSUFBSSxDQUFDLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLG1CQUFtQixFQUFFLENBQUMsRUFBRSxFQUFFO1FBQy9ELElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFpQyxDQUFDLEVBQUU7WUFDckQsSUFBSSxDQUFDLEtBQUssbUJBQW1CLEVBQUU7Z0JBQzdCLGNBQWMsR0FBRyxDQUFDLENBQUM7Z0JBQ25CLFNBQVM7YUFDVjtZQUVELElBQUksQ0FBQyxHQUFHLGNBQWMsR0FBRyxDQUFDLEVBQUU7Z0JBQzFCLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7WUFFRCxjQUFjLEdBQUcsQ0FBQyxDQUFDO1NBQ3BCO0tBQ0Y7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFsQkQsOERBa0JDIn0=